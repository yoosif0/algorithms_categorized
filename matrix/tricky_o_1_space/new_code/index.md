The trick for O(1) space is to have new codes that identify previous and new states
